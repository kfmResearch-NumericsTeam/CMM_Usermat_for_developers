!-----------------------------------------------------------------------
!     SUBROUTINE ZUR BERECHNUNG DER BERECHNUNG DER HAUPTVERZERRUNGS-
!     RICHTUNG NACH DER ALLGEMEINEN G�LTIGEN KINEMATISCHEN
!     VERTR�GLICHKEITSBEZIEHUNG
!
!     PROGRAMMIERUNG:     DR. KAREL THOMA, HOCHSCHULE LUZERN
!                         PATRICK ROOS, HOCHSCHULE LUZERN
!     DATUM:              14.03.2014
!-----------------------------------------------------------------------
      SUBROUTINE SUB_THETA_ALLGEMEIN(EX,EY,GAMMA_XY,THETA)

      IMPLICIT NONE

      ! VARIABLENDEKLARATION
      DOUBLE COMPLEX, INTENT(IN) :: EX, EY, GAMMA_XY
      DOUBLE COMPLEX, INTENT(OUT) :: THETA
      DOUBLE COMPLEX :: PI
      LOGICAL :: LR, LC

      ! INTERFACES ZU EXTERNEN FUNKTIONEN
      INTERFACE
      FUNCTION ATAN2_C(Y,X)
        DOUBLE COMPLEX             :: ATAN2_C
        DOUBLE COMPLEX, INTENT(IN) :: X,Y
      END FUNCTION ATAN2_C
      END INTERFACE

      ! BERECHNUNG THETA
      PI = CMPLX(4.D0*ATAN(1.0D0),0D0,KIND=8)

      IF (REAL(GAMMA_XY) .EQ. 0D0 .AND. REAL(EY) .EQ. REAL(EX)) THEN

        THETA = PI/CMPLX(4.D0,0D0,KIND=8)

      ELSE IF (REAL(GAMMA_XY) >= 0D0 .AND. REAL(EY) >= REAL(EX)) THEN

        THETA = CMPLX(0.5D0,0D0,KIND=8)*ATAN2_C(GAMMA_XY,(EY-EX))

      ELSE IF (REAL(GAMMA_XY) >= 0D0 .AND. REAL(EY) < REAL(EX)) THEN

        THETA = CMPLX(0.5D0,0D0,KIND=8)*ATAN2_C(GAMMA_XY,(EY-EX))

      ELSE IF (REAL(GAMMA_XY) < 0D0 .AND. REAL(EY) < REAL(EX)) THEN

        THETA = CMPLX(0.5D0,0D0,KIND=8)*ATAN2_C(GAMMA_XY,(EY-EX))

      ELSE IF (REAL(GAMMA_XY) < 0D0 .AND. REAL(EY) >= REAL(EX)) THEN

        THETA = CMPLX(0.5D0,0D0,KIND=8)*ATAN2_C(GAMMA_XY,(EY-EX))+PI

      END IF

      LR = ISNAN(REAL(THETA))
      LC = ISNAN(AIMAG(THETA))

      IF (LR) THEN
        THETA = CMPLX(0D0,AIMAG(THETA),KIND=8)
      END IF

      IF (LC) THEN
        THETA = CMPLX(REAL(THETA),0D0,KIND=8)
      END IF

      END SUBROUTINE SUB_THETA_ALLGEMEIN
