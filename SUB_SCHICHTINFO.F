!-----------------------------------------------------------------------
!     SUBROUTINE ZUR BESTIMMUNG IN WELCHER SCHICHT SICH DIE BERECHNUNG
!     BEFINDENT.
!
!     PROGRAMMIERUNG:     DR. KAREL THOMA, HOCHSCHULE LUZERN
!                         PATRICK ROOS, HOCHSCHULE LUZERN
!     DATUM:              03.06.2014
!-----------------------------------------------------------------------
      SUBROUTINE SUB_SCHICHTINFO(MATERIAL_ORG,KLAYER
     &                              ,SCHICHTINFO,IREF,ZSI)

      IMPLICIT NONE

      ! VARIABLENDEKLARATION
      DOUBLE PRECISION, DIMENSION(76), INTENT(IN) :: MATERIAL_ORG
      INTEGER, INTENT(IN) :: KLAYER
      INTEGER, INTENT(OUT) :: SCHICHTINFO
      INTEGER, DIMENSION(4), INTENT(OUT) :: IREF
      DOUBLE PRECISION, DIMENSION(4),INTENT(OUT) :: ZSI
      INTEGER :: IREF_1, IREF_2, IREF_3, IREF_4, DIMENS


      DOUBLE COMPLEX ::   DELTA_H, ZS1, ZS2, ZS3, ZS4, CU, CO,
     &                    DM1, DM2, DM3, DM4, H, N, AS1, AS2, AS3, AS4


      ! EINLESEN DER BENï¿½TIGTEN VARIABELN
      DIMENS = INT(MATERIAL_ORG(1))

      N = CMPLX(MATERIAL_ORG(3),0D0,KIND=8)
      H = CMPLX(MATERIAL_ORG(4),0D0,KIND=8)
      CO = CMPLX(MATERIAL_ORG(5),0D0,KIND=8)
      CU = CMPLX(MATERIAL_ORG(6),0D0,KIND=8)

      DM1 = CMPLX(MATERIAL_ORG(49),0D0,KIND=8)
      DM2 = CMPLX(MATERIAL_ORG(36),0D0,KIND=8)
      DM3 = CMPLX(MATERIAL_ORG(23),0D0,KIND=8)
      DM4 = CMPLX(MATERIAL_ORG(10),0D0,KIND=8)

      AS1 = CMPLX(MATERIAL_ORG(48),0D0,KIND=8)
      AS2 = CMPLX(MATERIAL_ORG(35),0D0,KIND=8)
      AS3 = CMPLX(MATERIAL_ORG(22),0D0,KIND=8)
      AS4 = CMPLX(MATERIAL_ORG(9),0D0,KIND=8)

      DELTA_H = H/N

      ! SCHWERPUNKTE DER BEWERHUNGSLAGEN

      ZS1 = -(H/CMPLX(2D0,0D0,KIND=8))+CU+(DM1/CMPLX(2D0,0D0,KIND=8))     !ABSTAND VON MITTELEBENE DER PLATTE BIS ZUM S-PUNKT DER 1.LAGE [MM]
      ZS2 = -(H/CMPLX(2D0,0D0,KIND=8))+CU+DM1+
     &       (DM2/CMPLX(2D0,0D0,KIND=8)) !ABSTAND VON MITTELEBENE DER PLATTE BIS ZUM S-PUNKT DER 2.LAGE [MM]
      ZS3 = (H/CMPLX(2D0,0D0,KIND=8))-
     &       (CO+DM4+(DM3/CMPLX(2D0,0D0,KIND=8)))!ABSTAND VON MITTELEBENE DER PLATTE BIS ZUM S-PUNKT DER 3.LAGE [MM]
      ZS4 = (H/CMPLX(2D0,0D0,KIND=8))-(CO+(DM4/CMPLX(2D0,0D0,KIND=8)))    !ABSTAND VON MITTELEBENE DER PLATTE BIS ZUM S-PUNKT DER 4.LAGE [MM]

      ZSI(1) = REAL(ZS1)
      ZSI(2) = REAL(ZS2)
      ZSI(3) = REAL(ZS3)
      ZSI(4) = REAL(ZS4)

      ! BESTIMMUNG DER BEWEHRTEN SCHICHT

      IREF_1 = INT(FLOOR(REAL(((H/CMPLX(2D0,0D0,KIND=8))+ZS1)/DELTA_H))+
     &         REAL(CMPLX(1D0,0D0,KIND=8)))
      IREF_2 = INT(FLOOR(REAL(((H/CMPLX(2D0,0D0,KIND=8))+ZS2)/DELTA_H))+
     &         REAL(CMPLX(1D0,0D0,KIND=8)))
      IREF_3 = INT(CEILING(REAL(((H/CMPLX(2D0,0D0,KIND=8))+ZS3)
     &          /DELTA_H)))
      IREF_4 = INT(CEILING(REAL(((H/CMPLX(2D0,0D0,KIND=8))+ZS4)
     &          /DELTA_H)))

      IREF(1) = IREF_1
      IREF(2) = IREF_2
      IREF(3) = IREF_3
      IREF(4) = IREF_4

      IF (DIMENS .EQ. 2) THEN ! 3D-BERECHNUNG:

        IF (REAL(N) .GT. 1D0) THEN

            IF (KLAYER .EQ. IREF_1) THEN

                SCHICHTINFO = 1

            ELSE IF (KLAYER .EQ. IREF_2) THEN

                SCHICHTINFO = 2

            ELSE IF (KLAYER .EQ. IREF_3) THEN

                SCHICHTINFO = 3

            ELSE IF (KLAYER .EQ. IREF_4) THEN

                SCHICHTINFO = 4

            ELSE

            SCHICHTINFO = 0

            END IF
        ELSE

            SCHICHTINFO = 5
        END IF

      ELSE ! 2D-BERECHNUNG:

      SCHICHTINFO = 6

      END IF

      END SUBROUTINE SUB_SCHICHTINFO